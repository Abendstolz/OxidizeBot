image: Visual Studio 2017

environment:
  matrix:
    - channel: nightly
      target: x86_64-pc-windows-msvc

install:
  - curl -sSf -o rustup-init.exe https://win.rustup.rs
  - rustup-init.exe --default-host %target% --default-toolchain %channel% -y
  - set PATH=%PATH%;C:\Users\appveyor\.cargo\bin
  - rustc -Vv
  - cargo -V
  - cargo install cargo-wix

build_script:
  - ps: .\tools\build.ps1

artifacts:
  - path: "*.zip"
    name: archive
  - path: "*.msi"
    name: installer

branches:
  only:
    - master
    - /\d+\.\d+\.\d+/

deploy:
  - release: $(appveyor_repo_tag_name)
    provider: GitHub
    auth_token:
      secure: opsYSU1MsMMLlC3c/VJLZ0b4XGEMdVEJ0WZ2dRF+GtXjoVa5zy+wnxxrhg5gHP+G
    artifact: /.*\.(zip|msi)/
    draft: true
    prerelease: false
    on:
      APPVEYOR_REPO_TAG: true